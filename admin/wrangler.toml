# =============================================================================
# PawMatch Admin Service Configuration
# =============================================================================

# -----------------------------------------------------------------------------
# Base Configuration
# -----------------------------------------------------------------------------
name = "pawmatch-admin"
main = "src/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# -----------------------------------------------------------------------------
# Default Environment Variables
# -----------------------------------------------------------------------------
[vars]
NODE_ENV = "development"
# カンマ区切りで許可するIPアドレスを指定（空文字列の場合はすべてのIPを許可）
ALLOWED_IPS = ""
# 管理者認証用シークレット（本番環境では必ず変更すること）
ADMIN_SECRET = "development-secret-key-change-in-production"

# -----------------------------------------------------------------------------
# Resource Bindings
# -----------------------------------------------------------------------------

# D1 Database
[[d1_databases]]
binding = "DB"
database_name = "pawmatch-db"
database_id = "b397c3a4-3ee4-4259-b004-6de4488e921f"

# KV Namespace (API Keys Cache)
[[kv_namespaces]]
binding = "API_KEYS_CACHE"
id = "ec30a1e116fb42c081ad0b7f07d413da"

# R2 Bucket (Image Storage)
[[r2_buckets]]
binding = "IMAGES_BUCKET"
bucket_name = "pawmatch-images"

# =============================================================================
# Environment-specific Configurations
# =============================================================================

# -----------------------------------------------------------------------------
# Production Environment
# -----------------------------------------------------------------------------
[env.production]
name = "pawmatch-admin"

[env.production.vars]
NODE_ENV = "production"
# Cloudflare Accessで制限するため、IP制限は無効化
ALLOWED_IPS = ""
# 本番環境では必ず強力なシークレットに変更すること
ADMIN_SECRET = "production-secret-key-please-change"

[[env.production.d1_databases]]
binding = "DB"
database_name = "pawmatch-db"
database_id = "b397c3a4-3ee4-4259-b004-6de4488e921f"

[[env.production.kv_namespaces]]
binding = "API_KEYS_CACHE"
id = "ec30a1e116fb42c081ad0b7f07d413da"

[[env.production.r2_buckets]]
binding = "IMAGES_BUCKET"
bucket_name = "pawmatch-images"

# -----------------------------------------------------------------------------
# Development Environment
# -----------------------------------------------------------------------------
[env.development]
name = "pawmatch-admin-dev"

[env.development.vars]
NODE_ENV = "development"
ALLOWED_IPS = ""
ADMIN_SECRET = "development-secret-key"

# -----------------------------------------------------------------------------
# Local Development Server
# -----------------------------------------------------------------------------
[dev]
port = 8788
inspector_port = 10788