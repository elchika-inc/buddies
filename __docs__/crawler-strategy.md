# ペットのおうち クローラー設計仕様書

## サイト分析結果

### 基本情報
- **対象サイト**: https://www.pet-home.jp/cats/
- **ページ形式**: 28件/ページ、最大10ページまで表示
- **URL構造**: 個別ページは `/cats/{地域}/{ID}/` の形式

### robots.txt制限
- **Googleクローラー**: 制限なし
- **Bingクローラー**: 10秒のCrawl-delay
- **一般クローラー**: 明示的制限なし（倫理的配慮が必要）

## クローリング戦略

### 1. 推奨アプローチ
**ヘッドレスブラウザ方式**
- **理由**: JavaScriptに依存した動的コンテンツが多数存在
- **ツール**: Playwright、Puppeteer、Selenium
- **メリット**: 完全なページレンダリング、JavaScriptコンテンツの取得

### 2. 代替アプローチ
**HTTP + HTMLパーサー方式**
- **ツール**: requests + BeautifulSoup (Python)、axios + cheerio (Node.js)
- **制限**: JavaScript依存のコンテンツは取得不可
- **メリット**: 高速、軽量

## データ取得フロー

### Phase 1: 一覧ページの巡回
```
1. https://www.pet-home.jp/cats/ にアクセス
2. 各猫の個別ページURLを抽出
3. ページネーション（1〜10ページ）を順次処理
4. URL一覧を収集・重複除去
```

### Phase 2: 個別ページのスクレイピング
```
1. 個別ページにアクセス
2. データ項目を抽出
3. 画像URLの有効性確認
4. データベースに保存
```

## HTMLセレクター仕様

### 一覧ページ
- **猫カードコンテナ**: `.pet_box` または類似のクラス
- **個別ページリンク**: `a[href*="/cats/"]`
- **ページネーション**: `.pagination` 内のリンク

### 個別ページ
- **名前**: `h1` タグまたはタイトル部分
- **基本情報**: `.pet_data` または類似の構造化要素
- **画像**: `img` タグ（メイン写真）
- **説明文**: テキストコンテンツ部分
- **募集者情報**: 連絡先セクション

## 技術実装要件

### レート制限対策
```javascript
// リクエスト間隔の制御
const delay = (ms) => new Promise(resolve => setTimeout(resolve, ms));

// 推奨間隔: 2-3秒
await delay(2000);
```

### User-Agent設定
```
User-Agent: Mozilla/5.0 (compatible; PawMatchBot/1.0; +https://yoursite.com/bot)
```

### エラーハンドリング
- **HTTPエラー**: 3回まで再試行
- **タイムアウト**: 30秒でタイムアウト
- **404エラー**: スキップして次へ
- **5xx エラー**: 指数バックオフで再試行

## データマッピング仕様

### 基本情報マッピング
| PawMatchフィールド | ペットのおうち表示 | 抽出方法 |
|---|---|---|
| name | タイトル部分から | `h1` または `.pet_title` |
| breed | 猫の種類 | テキスト解析 |
| age | 年齢表示 | 正規表現抽出 |
| gender | ♂/♀表示 | アイコン・テキスト解析 |
| location | 所在地 | 地域表示部分 |
| description | 詳細説明 | 本文テキスト |

### データクレンジング
```python
# 年齢の正規化
def normalize_age(age_text):
    if "子猫" in age_text or "生後" in age_text:
        return extract_months_or_default(age_text, 0.5)
    return extract_number(age_text)

# 性別の正規化
def normalize_gender(gender_text):
    if "♂" in gender_text or "オス" in gender_text:
        return "男の子"
    return "女の子"
```

## リーガル・エシカル配慮

### 利用規約遵守
- サイトの利用規約確認必須
- 営利目的の制限確認
- データ利用許諾の取得検討

### 技術的配慮
- 過度なアクセス負荷を避ける
- robots.txtの遵守
- 適切なUser-Agentの使用
- サーバー負荷監視

### データ取扱い
- 個人情報の適切な処理
- 画像著作権の確認
- データの定期更新・削除

## 実装スケジュール

### Phase 1: プロトタイプ (1-2日)
- 基本的なスクレイパーの実装
- 少数サンプルでのテスト

### Phase 2: 本格実装 (3-5日)
- 全データ項目の対応
- エラーハンドリング強化
- データベース連携

### Phase 3: 運用化 (2-3日)
- スケジュール実行
- 監視・アラート機能
- ログ・メトリクス

## 監視・メンテナンス

### KPI指標
- 取得成功率: 95%以上
- データ品質: 必須項目埋まり率90%以上
- 実行時間: 全データ取得2時間以内

### アラート条件
- 取得失敗率20%超過
- 新規データ0件が2日連続
- 実行時間が平均の2倍超過

## セキュリティ考慮事項

### アクセス制御
- IP制限の実装
- アクセスログの保存
- 異常アクセス検知

### データ保護
- 収集データの暗号化
- アクセスログの匿名化
- 定期的なセキュリティ監査